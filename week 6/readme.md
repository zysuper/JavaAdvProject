# 第 六 周作业

## 题目 01：

一条 SQL 语句在 MySQL 中是如何执行的？

![image-20231023163130939](../../../../.config/Typora/typora-user-images/image-20231023163130939.png)

如上图，步骤如下：

1. 客户端通过 tcp/ip 协议连接到数据库`连接器`。
2. 数据库连接器收到数据后，先查询 MySql 的缓存数据，如果没有开启缓存或者缓存没有命中，进入 3 。
3. 对客户端传入的 SQL 语句进行 词法解析、语法分析、预处理，生成 SQL 的 `解析树` ，然后进入优化器。
4. 优化器会按照自己的策略，抉择如何执行这个 SQL,是否使用索引还是全表扫描，最终生成执行计划。
5. 执行计划会交给执行器调用存储引擎进行SQL 动作的执行。
6. 存储引擎按照执行器传入的指令存储数据。

##  题目 02

请解释一下你理解的事务是什么？

### 事务四大特性 ACID

事务具有四个特征：原子性（ Atomicity ）、一致性（ Consistency ）、隔离性（ Isolation ）和持续性（ Durability ）。这四个特性简称为 ACID 特性。

原子性

原子性是指事务是一个不可分割的工作单位，事务中的操作要么都发生，要么都不发生。

一致性

数据库总是从一个一致性的状态转移到另一个一致性的状态。一致性确保了即使在执行第三、第四条语句之间时系统崩溃，前面执行的第一、第二条语句也不会生效，因为事务最终没有提交，所有事务中所作的修改也不会保存到数据库中。

隔离性

一个事务的执行不能其它事务干扰。即一个事务内部的操作及使用的数据对其它并发事务是隔离的，并发执行的各个事务之间不能互相干扰。

持续性

指一个事务一旦提交，它对数据库中的数据的改变就应该是永久性的。接下来的其它操作或故障不应该对其执行结果有任何影响。

### 事务隔离级别

[数据库](https://cloud.tencent.com/solution/database?from_column=20065&from=20065)事务的隔离级别有4种，由低到高分别为`Read uncommitted` 、`Read committed` 、`Repeatable read` 、`Serializable` 。而且，在事务的并发操作中可能会出现脏读，不可重复读，幻读。下面通过事例一一阐述它们的概念与联系。

1. 读未提交（Read Uncommitted）：在该隔离级别下，一个事务可以读取到另一个事务尚未提交的数据。这会导致脏读（Dirty Read），即读取到未确认的、可能会被回滚的数据。
2. 读提交（Read Committed）：在该隔离级别下，一个事务只能读取到已经提交的数据。这避免了脏读，但可能会导致不可重复读（Non-repeatable Read），即在同一个事务中，同样的查询可能返回不同的结果。
3. 可重复读（Repeatable Read）：在该隔离级别下，一个事务在执行期间多次读取同样的数据，将会得到一致的结果。即使其他事务对数据进行了修改，该事务读取的数据依然是事务开始时的快照。这避免了脏读和不可重复读，但可能会导致幻读（Phantom Read），即在同一个事务中，同样的查询可能返回不同的行数。
4. 串行化（Serializable）：在该隔离级别下，所有的事务依次串行执行，每个事务只能访问已提交的数据。这是最高的隔离级别，可以避免脏读、不可重复读和幻读，但会导致并发性能下降，因为事务需要依次执行。

### 事务会产生的并发问题

1. 脏读（Dirty Read）：一个事务读取到了另一个事务尚未提交的数据。如果这个事务后续回滚了，那么读取到的数据实际上是无效或错误的。
2. 不可重复读（Non-repeatable Read）：一个事务在同一个查询中多次读取同一数据，但在事务执行期间，其他事务修改了该数据，导致每次读取的结果不一致。
3. 幻读（Phantom Read）：一个事务在同一个查询中多次读取数据，但在事务执行期间，其他事务插入了符合查询条件的新数据，导致每次读取返回不同的行数。
4. 丢失更新（Lost Update）：两个事务同时读取同一数据，并且基于这个数据进行修改后再提交，但由于执行顺序的问题，其中一个事务的修改被另一个事务覆盖，导致修改丢失。

### 事务的安全性、性能与隔离级别的关系

事务的安全性、性能和隔离级别之间存在着一种权衡关系。较高的隔离级别通常可以提供更高的数据安全性，但可能会对性能产生负面影响。

较高的隔离级别（如可重复读或串行化）可以避免脏读、不可重复读和幻读等并发问题，确保数据的一致性和正确性。然而，为了实现这种高级别的隔离，数据库系统可能需要采用锁机制、多版本并发控制等复杂的并发控制机制，这可能导致额外的开销和性能下降。

相比之下，较低的隔离级别（如读提交或读未提交）可以提供更好的性能，因为它们较少使用锁或并发控制机制，允许更高的并发度。然而，较低的隔离级别可能会引入脏读、不可重复读或幻读等并发问题，可能导致数据的不一致性。

因此，在选择事务的隔离级别时，需要综合考虑应用程序对数据一致性的要求和对性能的需求。如果应用程序对数据的准确性和一致性要求较高，可以选择较高的隔离级别，尽管可能会牺牲一些性能。如果应用程序对性能要求较高，并且可以容忍一定程度的数据不一致性，可以选择较低的隔离级别以提升性能。

需要注意的是，隔离级别只是事务安全性和性能之间的一个因素，还有其他因素如数据库架构、硬件资源、并发负载等也会对事务的安全性和性能产生影响。因此，在设计和实现事务时，需要综合考虑各种因素，并进行性能测试和优化以达到最佳的安全性和性能平衡。